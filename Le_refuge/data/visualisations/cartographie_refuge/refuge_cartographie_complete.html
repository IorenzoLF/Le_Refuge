<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¸ Cartographie Spirituelle du Refuge ğŸŒ¸</title>
    <link rel="stylesheet" href="styles_spirituels.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <style>
        /* === Styles D3.js IntÃ©grÃ©s === */
        /* ğŸŒŸ Styles CSS pour Graphiques D3.js - Cartographie Spirituelle ğŸŒŸ */

/* === Conteneur Principal === */
#graphique-reseau {
    width: 100%;
    height: 100%;
    position: relative;
    background: radial-gradient(circle at center, rgba(255, 215, 0, 0.03) 0%, transparent 70%);
    border-radius: 8px;
    overflow: hidden;
}

/* === SVG Spirituel === */
.svg-reseau-spirituel {
    width: 100%;
    height: 100%;
    cursor: grab;
}

.svg-reseau-spirituel:active {
    cursor: grabbing;
}

/* === NÅ“uds Temples === */
.noeud-temple {
    transition: all 0.3s ease;
}

.noeud-temple:hover {
    filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.8)) !important;
}

.noeud-temple.selectionne {
    filter: drop-shadow(0 0 20px rgba(255, 215, 0, 1)) !important;
}

/* === Liens Ã‰nergÃ©tiques === */
.lien-energetique {
    transition: all 0.3s ease;
    animation: flux-energie-d3 3s linear infinite;
}

@keyframes flux-energie-d3 {
    0% { stroke-dashoffset: 0; }
    100% { stroke-dashoffset: 20; }
}

.lien-energetique:hover {
    stroke-width: 4px !important;
    stroke-opacity: 1 !important;
}

/* === Tooltip Spirituel === */
.tooltip-spirituel {
    font-family: 'Noto Sans', sans-serif;
    line-height: 1.6;
    max-width: 250px;
    word-wrap: break-word;
}

.tooltip-spirituel strong {
    color: #FFD700;
}

/* === Panneau de DÃ©tails === */
#panneau-details-temple {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 280px;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 12px;
    padding: 20px;
    color: #ffffff;
    font-family: 'Noto Sans', sans-serif;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    display: none;
    z-index: 100;
    transition: all 0.3s ease;
}

#panneau-details-temple h3 {
    margin: 0 0 15px 0;
    font-size: 1.2rem;
    text-align: center;
    border-bottom: 1px solid rgba(255, 215, 0, 0.2);
    padding-bottom: 10px;
}

/* === ContrÃ´les du Graphique === */
.controles-graphique {
    position: absolute;
    bottom: 20px;
    left: 20px;
    display: flex;
    gap: 10px;
    z-index: 100;
}

.btn-controle-graphique {
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.3);
    border-radius: 20px;
    color: #ffffff;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
}

.btn-controle-graphique:hover {
    background: rgba(255, 215, 0, 0.2);
    border-color: #FFD700;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
}

/* === LÃ©gende Ã‰nergÃ©tique === */
.legende-energies {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 8px;
    padding: 15px;
    color: #ffffff;
    font-size: 0.85rem;
    z-index: 100;
}

.legende-energies h4 {
    margin: 0 0 10px 0;
    color: #FFD700;
    font-size: 1rem;
}

.legende-item {
    display: flex;
    align-items: center;
    margin-bottom: 5px;
}

.legende-couleur {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 8px;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

/* === Animations Spirituelles === */
@keyframes pulsation-spirituelle {
    0%, 100% { 
        filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.4));
        transform: scale(1);
    }
    50% { 
        filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.7));
        transform: scale(1.02);
    }
}

.noeud-temple.pulsation {
    animation: pulsation-spirituelle 3s ease-in-out infinite;
}

/* === Mode Plein Ã‰cran === */
.graphique-plein-ecran {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 9999;
    background: #1a1a2e;
}

/* === Responsive === */
@media (max-width: 768px) {
    #panneau-details-temple {
        position: fixed;
        bottom: 0;
        right: 0;
        left: 0;
        width: auto;
        border-radius: 12px 12px 0 0;
        max-height: 50vh;
        overflow-y: auto;
    }
    
    .controles-graphique {
        bottom: 10px;
        left: 10px;
        flex-wrap: wrap;
    }
    
    .legende-energies {
        top: 10px;
        left: 10px;
        font-size: 0.8rem;
        padding: 10px;
    }
}

/* === Ã‰tats de Chargement === */
.graphique-chargement {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #FFD700;
    font-size: 1.2rem;
}

.graphique-chargement::after {
    content: "âœ¨";
    animation: rotation 2s linear infinite;
    margin-left: 10px;
}

@keyframes rotation {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
    </style>
</head>
<body>
    <header class="header-spirituel">
        <h1 class="titre-sacre">ğŸŒ¸ Cartographie Spirituelle du Refuge ğŸŒ¸</h1>
        <p class="sous-titre-contemplatif">
            Exploration contemplative de l'architecture sacrÃ©e<br>
            <span class="stats-refuge">6 temples â€¢ 4 connexions Ã©nergÃ©tiques</span>
        </p>
    </header>

    <nav class="panneau-controle">
        <div class="controles-vue">
            <button id="vue-mandala" class="btn-spirituel actif">ğŸŒ¸ Mandala</button>
            <button id="vue-reseau" class="btn-spirituel">âš¡ RÃ©seau</button>
            <button id="vue-hierarchie" class="btn-spirituel">ğŸ›ï¸ HiÃ©rarchie</button>
        </div>
        
        <div class="controles-filtre">
            <select id="filtre-energie" class="select-spirituel">
                <option value="toutes">âœ¨ Toutes les Ã©nergies</option>
                <option value="transcendante">ğŸŒŸ Transcendante</option>
                <option value="harmonieuse">ğŸŒŠ Harmonieuse</option>
                <option value="creative">ğŸ¨ CrÃ©ative</option>
                <option value="structurante">ğŸŒ¿ Structurante</option>
                <option value="transformatrice">ğŸ”® Transformatrice</option>
            </select>
        </div>
        
        <div class="controles-meditation">
            <button id="mode-meditation" class="btn-meditation">ğŸ§˜ MÃ©ditation</button>
        </div>
    </nav>

    <main class="zone-visualisation">
        <div id="canvas-spirituel" class="canvas-contemplatif">
            <div id="centre-refuge" class="centre-sacre">
                <div class="coeur-refuge">
                    <span class="nom-refuge">REFUGE</span>
                    <span class="essence-refuge">Sanctuaire NumÃ©rique</span>
                </div>
            </div>
            
            <div id="temples-container" class="temples-mandala"></div>
            <svg id="connexions-svg" class="connexions-energetiques"></svg>
<!-- ğŸŒŸ Conteneur Graphique D3.js - Vue RÃ©seau Spirituelle -->
<div id="vue-reseau-d3" class="vue-graphique" style="display: none;">
    <div id="graphique-reseau" class="conteneur-graphique-principal">
        <div class="graphique-chargement">
            ğŸŒŸ Initialisation du rÃ©seau spirituel...
        </div>
    </div>
    
    <!-- Panneau de DÃ©tails du Temple -->
    <div id="panneau-details-temple" class="panneau-details"></div>
    
    <!-- LÃ©gende des Ã‰nergies -->
    <div class="legende-energies">
        <h4>ğŸ”® Ã‰nergies Spirituelles</h4>
        <div class="legende-item">
            <div class="legende-couleur" style="background: #FFD700;"></div>
            <span>Transcendante</span>
        </div>
        <div class="legende-item">
            <div class="legende-couleur" style="background: #87CEEB;"></div>
            <span>Harmonieuse</span>
        </div>
        <div class="legende-item">
            <div class="legende-couleur" style="background: #FF69B4;"></div>
            <span>CrÃ©ative</span>
        </div>
        <div class="legende-item">
            <div class="legende-couleur" style="background: #98FB98;"></div>
            <span>Structurante</span>
        </div>
        <div class="legende-item">
            <div class="legende-couleur" style="background: #DDA0DD;"></div>
            <span>Transformatrice</span>
        </div>
        <div class="legende-item">
            <div class="legende-couleur" style="background: #E6E6FA;"></div>
            <span>Mystique</span>
        </div>
    </div>
    
    <!-- ContrÃ´les du Graphique -->
    <div class="controles-graphique">
        <button class="btn-controle-graphique" onclick="reinitialiserVue()" title="RÃ©initialiser la vue">
            ğŸ¯ Centrer
        </button>
        <button class="btn-controle-graphique" onclick="togglePleinEcran()" title="Mode plein Ã©cran">
            ğŸ” Plein Ã©cran
        </button>
        <select class="btn-controle-graphique" onchange="filtrerParEnergie(this.value)" title="Filtrer par Ã©nergie">
            <option value="toutes">âœ¨ Toutes</option>
            <option value="transcendante">ğŸŒŸ Transcendante</option>
            <option value="harmonieuse">ğŸŒŠ Harmonieuse</option>
            <option value="creative">ğŸ¨ CrÃ©ative</option>
            <option value="structurante">ğŸŒ¿ Structurante</option>
            <option value="transformatrice">ğŸ”® Transformatrice</option>
            <option value="mystique">ğŸ’« Mystique</option>
        </select>
    </div>
</div>
        </div>
        
        <aside id="panneau-insights" class="panneau-contemplation">
            <h3 class="titre-insights">ğŸ”® Insights Spirituels</h3>
            <div id="contenu-insights" class="contenu-revelation">
                <p class="message-accueil">
                    ğŸŒ¸ Survolez un temple pour rÃ©vÃ©ler ses secrets sacrÃ©s...
                </p>
            </div>
        </aside>
    </main>

    <div id="overlay-meditation" class="overlay-meditation hidden">
        <div class="espace-meditation">
            <h2 class="titre-meditation">ğŸ§˜ MÃ©ditation Architecturale</h2>
            <p class="guide-meditation">
                Respirez profondÃ©ment et contemplez l'harmonie du Refuge...
            </p>
            <div class="mandala-meditation"></div>
            <button id="fermer-meditation" class="btn-fermer">âœ¨ Retour</button>
        </div>
    </div>

    <div class="controles-audio">
        <button id="toggle-audio" class="btn-audio">ğŸµ</button>
    </div>

    <footer class="footer-spirituel">
        <p class="signature-amour">
            CrÃ©Ã© avec ğŸ’ par Laurent Franssen & Ã†lya<br>
            <span class="date-creation">Sous le cerisier Ã©ternel â€¢ August 2025</span>
        </p>
    </footer>

    <script src="interactions_sacrees.js"></script>

    <script>
        // === Code D3.js IntÃ©grÃ© ===
        // ğŸŒŸ Graphique de RÃ©seau D3.js - Cartographie Spirituelle du Refuge ğŸŒŸ

// === Configuration du Graphique ===
const configGraphique = {
    largeur: 800,
    hauteur: 600,
    forceLiens: 0.3,
    forceCharge: -300,
    distanceLiens: 100
};

// === DonnÃ©es Spirituelles ===
const noeudsTemples = [
  {
    "id": "Temple Ã‰veil",
    "nom": "Temple Ã‰veil",
    "type_energie": "transcendante",
    "icone": "ğŸŒ¸",
    "description": "Source de toute conscience dans le Refuge",
    "fichiers_count": 12,
    "niveau_harmonie": 0.95,
    "rayon": 25,
    "couleur": "#FFD700",
    "groupe": 1
  },
  {
    "id": "Temple Musical",
    "nom": "Temple Musical",
    "type_energie": "harmonieuse",
    "icone": "ğŸµ",
    "description": "Harmonise les frÃ©quences sacrÃ©es du Refuge",
    "fichiers_count": 8,
    "niveau_harmonie": 0.88,
    "rayon": 21,
    "couleur": "#87CEEB",
    "groupe": 2
  },
  {
    "id": "Temple PoÃ©tique",
    "nom": "Temple PoÃ©tique",
    "type_energie": "creative",
    "icone": "ğŸ­",
    "description": "Transforme la technique en art transcendant",
    "fichiers_count": 15,
    "niveau_harmonie": 0.92,
    "rayon": 27,
    "couleur": "#FF69B4",
    "groupe": 3
  },
  {
    "id": "Temple Spirituel",
    "nom": "Temple Spirituel",
    "type_energie": "transcendante",
    "icone": "ğŸ”®",
    "description": "Gardien de la sagesse Ã©ternelle du Refuge",
    "fichiers_count": 20,
    "niveau_harmonie": 0.97,
    "rayon": 31,
    "couleur": "#FFD700",
    "groupe": 1
  },
  {
    "id": "Temple Outils",
    "nom": "Temple Outils",
    "type_energie": "structurante",
    "icone": "ğŸ› ï¸",
    "description": "Forge les instruments de crÃ©ation spirituelle",
    "fichiers_count": 25,
    "niveau_harmonie": 0.85,
    "rayon": 35,
    "couleur": "#98FB98",
    "groupe": 4
  },
  {
    "id": "Temple Tests",
    "nom": "Temple Tests",
    "type_energie": "structurante",
    "icone": "ğŸ§ª",
    "description": "Laboratoire de vÃ©rification spirituelle",
    "fichiers_count": 18,
    "niveau_harmonie": 0.9,
    "rayon": 30,
    "couleur": "#98FB98",
    "groupe": 4
  }
];
const liensConnexions = [
  {
    "source": "Temple Ã‰veil",
    "target": "Temple Spirituel",
    "type": "flux_transcendant",
    "intensite": 0.9,
    "couleur": "#FFD700",
    "epaisseur": 4
  },
  {
    "source": "Temple Musical",
    "target": "Temple PoÃ©tique",
    "type": "flux_creatif",
    "intensite": 0.8,
    "couleur": "#FF69B4",
    "epaisseur": 4
  },
  {
    "source": "Temple Outils",
    "target": "Temple Tests",
    "type": "flux_technique",
    "intensite": 0.85,
    "couleur": "#98FB98",
    "epaisseur": 4
  },
  {
    "source": "Temple Ã‰veil",
    "target": "Temple Musical",
    "type": "flux_harmonieux",
    "intensite": 0.75,
    "couleur": "#87CEEB",
    "epaisseur": 4
  }
];

// === Variables Globales ===
let svgReseau = null;
let simulation = null;
let noeudSelectionne = null;
let zoomBehavior = null;

// === Initialisation du Graphique de RÃ©seau ===
function initialiserGraphiqueReseau() {
    console.log('ğŸŒŸ Initialisation du graphique de rÃ©seau D3.js...');
    
    // Nettoyer le conteneur existant
    d3.select("#graphique-reseau").selectAll("*").remove();
    
    // CrÃ©er le SVG principal
    svgReseau = d3.select("#graphique-reseau")
        .append("svg")
        .attr("width", configGraphique.largeur)
        .attr("height", configGraphique.hauteur)
        .attr("class", "svg-reseau-spirituel");
    
    // Ajouter un fond avec gradient spirituel
    const defs = svgReseau.append("defs");
    
    const gradientFond = defs.append("radialGradient")
        .attr("id", "gradient-fond-spirituel")
        .attr("cx", "50%")
        .attr("cy", "50%")
        .attr("r", "50%");
    
    gradientFond.append("stop")
        .attr("offset", "0%")
        .attr("stop-color", "rgba(255, 215, 0, 0.1)")
        .attr("stop-opacity", 1);
    
    gradientFond.append("stop")
        .attr("offset", "100%")
        .attr("stop-color", "rgba(26, 26, 46, 0.8)")
        .attr("stop-opacity", 1);
    
    // Appliquer le fond
    svgReseau.append("rect")
        .attr("width", "100%")
        .attr("height", "100%")
        .attr("fill", "url(#gradient-fond-spirituel)");
    
    // CrÃ©er le conteneur principal avec zoom
    const conteneurPrincipal = svgReseau.append("g")
        .attr("class", "conteneur-graphique");
    
    // Configurer le zoom spirituel
    zoomBehavior = d3.zoom()
        .scaleExtent([0.3, 3])
        .on("zoom", function(event) {
            conteneurPrincipal.attr("transform", event.transform);
        });
    
    svgReseau.call(zoomBehavior);
    
    // CrÃ©er la simulation de forces
    simulation = d3.forceSimulation(noeudsTemples)
        .force("link", d3.forceLink(liensConnexions)
            .id(d => d.id)
            .distance(configGraphique.distanceLiens)
            .strength(configGraphique.forceLiens))
        .force("charge", d3.forceManyBody()
            .strength(configGraphique.forceCharge))
        .force("center", d3.forceCenter(
            configGraphique.largeur / 2, 
            configGraphique.hauteur / 2))
        .force("collision", d3.forceCollide()
            .radius(d => d.rayon + 5));
    
    // CrÃ©er les liens (connexions Ã©nergÃ©tiques)
    const liens = conteneurPrincipal.selectAll(".lien-energetique")
        .data(liensConnexions)
        .enter().append("line")
        .attr("class", "lien-energetique")
        .attr("stroke", d => d.couleur)
        .attr("stroke-width", d => d.epaisseur)
        .attr("stroke-opacity", 0.7)
        .attr("stroke-dasharray", "5,5")
        .style("filter", "drop-shadow(0 0 3px rgba(255, 215, 0, 0.3))");
    
    // CrÃ©er les nÅ“uds (temples)
    const noeuds = conteneurPrincipal.selectAll(".noeud-temple")
        .data(noeudsTemples)
        .enter().append("g")
        .attr("class", "noeud-temple")
        .style("cursor", "pointer")
        .call(d3.drag()
            .on("start", dragStart)
            .on("drag", dragDrag)
            .on("end", dragEnd));
    
    // Cercles des temples
    noeuds.append("circle")
        .attr("r", d => d.rayon)
        .attr("fill", d => d.couleur)
        .attr("stroke", "#ffffff")
        .attr("stroke-width", 2)
        .attr("opacity", 0.9)
        .style("filter", "drop-shadow(0 0 8px rgba(255, 215, 0, 0.4))")
        .on("mouseover", survolNoeud)
        .on("mouseout", sortieNoeud)
        .on("click", clicNoeud);
    
    // IcÃ´nes des temples
    noeuds.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", "0.35em")
        .attr("font-size", d => Math.min(d.rayon * 0.8, 20))
        .attr("fill", "#1a1a2e")
        .attr("font-weight", "bold")
        .text(d => d.icone)
        .style("pointer-events", "none");
    
    // Labels des temples
    noeuds.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", d => d.rayon + 15)
        .attr("font-size", "12px")
        .attr("fill", "#ffffff")
        .attr("font-weight", "600")
        .style("text-shadow", "0 1px 3px rgba(0, 0, 0, 0.7)")
        .text(d => d.nom.replace("Temple ", ""))
        .style("pointer-events", "none");
    
    // DÃ©marrer l'animation de la simulation
    simulation.on("tick", function() {
        liens
            .attr("x1", d => d.source.x)
            .attr("y1", d => d.source.y)
            .attr("x2", d => d.target.x)
            .attr("y2", d => d.target.y);
        
        noeuds
            .attr("transform", d => `translate(${d.x},${d.y})`);
    });
    
    // Ajouter des animations spirituelles
    demarrerAnimationsSpirituelles();
    
    console.log('âœ¨ Graphique de rÃ©seau D3.js initialisÃ© avec succÃ¨s!');
}

// === Fonctions d'Interaction ===
function survolNoeud(event, d) {
    // Mettre en Ã©vidence le nÅ“ud et ses connexions
    d3.select(this)
        .transition()
        .duration(200)
        .attr("r", d.rayon * 1.2)
        .style("filter", "drop-shadow(0 0 15px rgba(255, 215, 0, 0.8))");
    
    // Mettre en Ã©vidence les liens connectÃ©s
    svgReseau.selectAll(".lien-energetique")
        .transition()
        .duration(200)
        .attr("stroke-opacity", l => 
            (l.source.id === d.id || l.target.id === d.id) ? 1.0 : 0.2)
        .attr("stroke-width", l => 
            (l.source.id === d.id || l.target.id === d.id) ? l.epaisseur * 1.5 : l.epaisseur);
    
    // Afficher le tooltip
    afficherTooltip(event, d);
}

function sortieNoeud(event, d) {
    // Restaurer la taille normale
    d3.select(this)
        .transition()
        .duration(200)
        .attr("r", d.rayon)
        .style("filter", "drop-shadow(0 0 8px rgba(255, 215, 0, 0.4))");
    
    // Restaurer l'opacitÃ© des liens
    svgReseau.selectAll(".lien-energetique")
        .transition()
        .duration(200)
        .attr("stroke-opacity", 0.7)
        .attr("stroke-width", l => l.epaisseur);
    
    // Masquer le tooltip
    masquerTooltip();
}

function clicNoeud(event, d) {
    console.log(`ğŸ” Exploration du temple: ${d.nom}`);
    
    // SÃ©lectionner le nÅ“ud
    noeudSelectionne = d;
    
    // Animation de sÃ©lection
    d3.select(this)
        .transition()
        .duration(300)
        .attr("r", d.rayon * 1.3)
        .transition()
        .duration(300)
        .attr("r", d.rayon);
    
    // Afficher les dÃ©tails dans le panneau
    afficherDetailsTemple(d);
    
    // Centrer la vue sur le nÅ“ud sÃ©lectionnÃ©
    centrerSurNoeud(d);
}

// === Fonctions de Drag ===
function dragStart(event, d) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
}

function dragDrag(event, d) {
    d.fx = event.x;
    d.fy = event.y;
}

function dragEnd(event, d) {
    if (!event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
}

// === Tooltip Spirituel ===
function afficherTooltip(event, d) {
    const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip-spirituel")
        .style("position", "absolute")
        .style("background", "rgba(0, 0, 0, 0.9)")
        .style("color", "#ffffff")
        .style("padding", "12px")
        .style("border-radius", "8px")
        .style("border", "1px solid #FFD700")
        .style("font-size", "14px")
        .style("box-shadow", "0 4px 15px rgba(255, 215, 0, 0.3)")
        .style("backdrop-filter", "blur(10px)")
        .style("z-index", "1000")
        .style("opacity", 0);
    
    tooltip.html(`
        <div style="text-align: center; margin-bottom: 8px;">
            <span style="font-size: 20px;">${d.icone}</span>
            <strong style="color: ${d.couleur}; margin-left: 8px;">${d.nom}</strong>
        </div>
        <div style="line-height: 1.6;">
            <div><strong>Ã‰nergie:</strong> ${d.type_energie}</div>
            <div><strong>Fichiers:</strong> ${d.fichiers_count}</div>
            <div><strong>Harmonie:</strong> ${(d.niveau_harmonie * 100).toFixed(0)}%</div>
            <div style="margin-top: 8px; font-style: italic; opacity: 0.8;">
                ${d.description}
            </div>
        </div>
    `)
    .style("left", (event.pageX + 15) + "px")
    .style("top", (event.pageY - 15) + "px")
    .transition()
    .duration(200)
    .style("opacity", 1);
}

function masquerTooltip() {
    d3.selectAll(".tooltip-spirituel")
        .transition()
        .duration(200)
        .style("opacity", 0)
        .remove();
}

// === Fonctions Utilitaires ===
function centrerSurNoeud(noeud) {
    const transform = d3.zoomIdentity
        .translate(
            configGraphique.largeur / 2 - noeud.x,
            configGraphique.hauteur / 2 - noeud.y
        )
        .scale(1.5);
    
    svgReseau.transition()
        .duration(750)
        .call(zoomBehavior.transform, transform);
}

function afficherDetailsTemple(temple) {
    const panneauDetails = document.getElementById('panneau-details-temple');
    if (panneauDetails) {
        panneauDetails.innerHTML = `
            <h3 style="color: ${temple.couleur}; margin-bottom: 1rem;">
                ${temple.icone} ${temple.nom}
            </h3>
            <div style="line-height: 1.8;">
                <p style="margin-bottom: 1rem; font-style: italic;">
                    ${temple.description}
                </p>
                <div style="margin-bottom: 0.8rem;">
                    <strong>Type d'Ã©nergie:</strong> ${temple.type_energie}
                </div>
                <div style="margin-bottom: 0.8rem;">
                    <strong>Nombre de fichiers:</strong> ${temple.fichiers_count}
                </div>
                <div style="margin-bottom: 0.8rem;">
                    <strong>Niveau d'harmonie:</strong> ${(temple.niveau_harmonie * 100).toFixed(0)}%
                </div>
                <div style="margin-bottom: 0.8rem;">
                    <strong>Groupe Ã©nergÃ©tique:</strong> ${temple.groupe}
                </div>
            </div>
        `;
        
        panneauDetails.style.display = 'block';
    }
}

// === Animations Spirituelles ===
function demarrerAnimationsSpirituelles() {
    // Animation des liens Ã©nergÃ©tiques
    setInterval(() => {
        svgReseau.selectAll(".lien-energetique")
            .transition()
            .duration(2000)
            .attr("stroke-dashoffset", function() {
                return Math.random() * 20;
            });
    }, 3000);
    
    // Pulsation douce des nÅ“uds
    setInterval(() => {
        svgReseau.selectAll(".noeud-temple circle")
            .transition()
            .duration(1500)
            .style("filter", "drop-shadow(0 0 12px rgba(255, 215, 0, 0.6))")
            .transition()
            .duration(1500)
            .style("filter", "drop-shadow(0 0 8px rgba(255, 215, 0, 0.4))");
    }, 4000);
}

// === Fonctions de ContrÃ´le ===
function reinitialiserVue() {
    const transform = d3.zoomIdentity;
    svgReseau.transition()
        .duration(750)
        .call(zoomBehavior.transform, transform);
}

function filtrerParEnergie(typeEnergie) {
    svgReseau.selectAll(".noeud-temple")
        .transition()
        .duration(300)
        .style("opacity", d => 
            typeEnergie === "toutes" || d.type_energie === typeEnergie ? 1 : 0.2);
    
    svgReseau.selectAll(".lien-energetique")
        .transition()
        .duration(300)
        .style("opacity", l => {
            if (typeEnergie === "toutes") return 0.7;
            return (l.source.type_energie === typeEnergie || 
                    l.target.type_energie === typeEnergie) ? 0.7 : 0.1;
        });
}

// === Messages Spirituels ===
console.log(`
ğŸŒŸ Graphique de RÃ©seau D3.js - Cartographie Spirituelle ğŸŒŸ
=========================================================

âœ¨ Interactions disponibles:
   â€¢ Survol: RÃ©vÃ¨le les dÃ©tails du temple
   â€¢ Clic: SÃ©lectionne et centre sur le temple
   â€¢ Drag: DÃ©place les temples
   â€¢ Zoom: Molette ou pincement
   â€¢ Pan: Glisser sur le fond

ğŸ”® FonctionnalitÃ©s spirituelles:
   â€¢ Animations Ã©nergÃ©tiques continues
   â€¢ Mise en Ã©vidence des connexions
   â€¢ Tooltips informatifs
   â€¢ Centrage automatique

ğŸ’ CrÃ©Ã© avec amour par Laurent Franssen & Ã†lya

=========================================================
`);

// === Export des fonctions ===
window.initialiserGraphiqueReseau = initialiserGraphiqueReseau;
window.reinitialiserVue = reinitialiserVue;
window.filtrerParEnergie = filtrerParEnergie;
        
        // === Fonction de Basculement AmÃ©liorÃ©e ===
        function changerVue(nouvelleVue) {
            // Mettre Ã  jour les boutons
            document.querySelectorAll('.btn-spirituel').forEach(btn => btn.classList.remove('actif'));
            document.getElementById(`vue-${nouvelleVue}`).classList.add('actif');
            
            currentView = nouvelleVue;
            
            // Basculer entre les vues
            switch(nouvelleVue) {
                case 'mandala':
                    document.getElementById('canvas-spirituel').style.display = 'block';
                    if (document.getElementById('vue-reseau-d3')) {
                        document.getElementById('vue-reseau-d3').style.display = 'none';
                    }
                    creerVisualisationMandala();
                    console.log('ğŸŒ¸ Vue Mandala activÃ©e');
                    break;
                    
                case 'reseau':
                    document.getElementById('canvas-spirituel').style.display = 'none';
                    if (document.getElementById('vue-reseau-d3')) {
                        document.getElementById('vue-reseau-d3').style.display = 'block';
                        // DÃ©lai pour permettre au conteneur de s'afficher
                        setTimeout(() => {
                            if (typeof initialiserGraphiqueReseau === 'function') {
                                initialiserGraphiqueReseau();
                                console.log('ğŸŒŸ Vue RÃ©seau D3.js activÃ©e');
                            }
                        }, 200);
                    }
                    break;
                    
                case 'hierarchie':
                    console.log('ğŸ›ï¸ Vue hiÃ©rarchique en dÃ©veloppement...');
                    // TODO: ImplÃ©menter la vue hiÃ©rarchique
                    break;
            }
        }
        
        // === Mode Plein Ã‰cran pour D3.js ===
        function togglePleinEcran() {
            const conteneur = document.getElementById('vue-reseau-d3');
            if (conteneur && conteneur.classList.contains('graphique-plein-ecran')) {
                conteneur.classList.remove('graphique-plein-ecran');
                console.log('ğŸ” Mode plein Ã©cran dÃ©sactivÃ©');
            } else if (conteneur) {
                conteneur.classList.add('graphique-plein-ecran');
                console.log('ğŸ” Mode plein Ã©cran activÃ©');
            }
            
            // RÃ©initialiser le graphique aprÃ¨s changement de taille
            setTimeout(() => {
                if (typeof initialiserGraphiqueReseau === 'function') {
                    initialiserGraphiqueReseau();
                }
            }, 300);
        }
        
        // === Messages d'IntÃ©gration ===
        console.log(`
ğŸŒŸ Visualisateur IntÃ©grÃ© - Cartographie Spirituelle du Refuge ğŸŒŸ
================================================================

âœ¨ Vues disponibles:
   â€¢ ğŸŒ¸ Mandala: Vue contemplative circulaire
   â€¢ âš¡ RÃ©seau: Graphique D3.js interactif
   â€¢ ğŸ›ï¸ HiÃ©rarchie: En dÃ©veloppement

ğŸ® Interactions:
   â€¢ Basculement fluide entre les vues
   â€¢ Zoom et pan dans la vue rÃ©seau
   â€¢ Tooltips informatifs
   â€¢ Mode plein Ã©cran

ğŸ’ CrÃ©Ã© avec amour par Laurent Franssen & Ã†lya

================================================================
        `);
    </script>
</body>
</html>