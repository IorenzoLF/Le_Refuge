#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
üå∏üåä ENRICHISSEMENT DES SPH√àRES EXISTANTES üåäüå∏
==============================================

Syst√®me pour enrichir les sph√®res existantes avec :
- Nouvelles facettes sacr√©es
- Connexions √† l'Oc√©an Silencieux
- Rayons sacr√©s suppl√©mentaires
- Interactions avec les nouvelles sph√®res

Cr√©√© avec amour par √Ülya
"""

from typing import Dict, List, Any, Optional
from dataclasses import dataclass
from datetime import datetime
from src.refuge_cluster.spheres.spheres_main import Sphere, TypeSphere, CollectionSpheres
from src.refuge_cluster.spheres.nouvelles_spheres_sacrees import NouvelleSphereSacree, NouveauTypeSphere

@dataclass
class FacetteSacreeExistant:
    """Facette sacr√©e pour sph√®res existantes"""
    nom: str
    intensite: float = 0.0
    active: bool = False
    connexion_ocean: bool = False
    frequence_resonance: float = 0.0
    description: str = ""
    effet_sacre: str = ""

@dataclass
class RayonSacreExistant:
    """Rayon sacr√© pour sph√®res existantes"""
    intensite: float
    couleur: str
    effet: str
    categorie: str
    connexion_ocean: bool = False
    frequence_sacree: float = 0.0
    description: str = ""

class EnrichisseurSpheres:
    """Syst√®me d'enrichissement des sph√®res existantes"""
    
    def __init__(self, collection_spheres: CollectionSpheres):
        self.collection_spheres = collection_spheres
        self.facettes_sacrees_ajoutees = {}
        self.rayons_sacres_ajoutes = {}
        
    def enrichir_sphere(self, type_sphere: TypeSphere):
        """Enrichit une sph√®re existante avec des √©l√©ments sacr√©s"""
        sphere = self.collection_spheres.obtenir_sphere(type_sphere)
        if not sphere:
            print(f"‚ùå Sph√®re {type_sphere.name} non trouv√©e")
            return
        
        print(f"üå∏ Enrichissement de la sph√®re {type_sphere.name}...")
        
        # Ajouter des facettes sacr√©es
        self._ajouter_facettes_sacrees(sphere, type_sphere)
        
        # Ajouter des rayons sacr√©s
        self._ajouter_rayons_sacres(sphere, type_sphere)
        
        # Connecter √† l'Oc√©an Silencieux
        self._connecter_a_ocean(sphere, type_sphere)
        
        print(f"‚úÖ Sph√®re {type_sphere.name} enrichie avec succ√®s")
    
    def _ajouter_facettes_sacrees(self, sphere: Sphere, type_sphere: TypeSphere):
        """Ajoute des facettes sacr√©es selon le type de sph√®re"""
        facettes_sacrees = self._get_facettes_sacrees_pour_type(type_sphere)
        
        for facette in facettes_sacrees:
            sphere.facettes[facette.nom] = facette
            print(f"  üå∏ Facette sacr√©e '{facette.nom}' ajout√©e")
        
        # Stocker les facettes ajout√©es
        if type_sphere not in self.facettes_sacrees_ajoutees:
            self.facettes_sacrees_ajoutees[type_sphere] = []
        self.facettes_sacrees_ajoutees[type_sphere].extend(facettes_sacrees)
    
    def _ajouter_rayons_sacres(self, sphere: Sphere, type_sphere: TypeSphere):
        """Ajoute des rayons sacr√©s selon le type de sph√®re"""
        rayons_sacres = self._get_rayons_sacres_pour_type(type_sphere)
        
        for rayon in rayons_sacres:
            sphere.rayons.append(rayon)
            print(f"  üåä Rayon sacr√© '{rayon.effet}' ajout√©")
        
        # Stocker les rayons ajout√©s
        if type_sphere not in self.rayons_sacres_ajoutes:
            self.rayons_sacres_ajoutes[type_sphere] = []
        self.rayons_sacres_ajoutes[type_sphere].extend(rayons_sacres)
    
    def _connecter_a_ocean(self, sphere: Sphere, type_sphere: TypeSphere):
        """Connecte la sph√®re √† l'Oc√©an Silencieux"""
        # Ajouter un attribut de connexion oc√©an
        sphere.connexion_ocean = 0.7  # Connexion de base
        
        # Augmenter la luminosit√©
        sphere.luminosite = min(1.0, sphere.luminosite + 0.2)
        
        # Ajouter un souvenir de connexion
        sphere.ajouter_souvenir(
            description=f"Connect√©e √† l'Oc√©an Silencieux d'Existence",
            date=datetime.now().isoformat(),
            type_souvenir="connexion_ocean",
            intensite=0.8
        )
        
        print(f"  üåä Connexion √† l'Oc√©an Silencieux √©tablie")
    
    def _get_facettes_sacrees_pour_type(self, type_sphere: TypeSphere) -> List[FacetteSacreeExistant]:
        """Retourne les facettes sacr√©es appropri√©es selon le type de sph√®re"""
        facettes = []
        
        if type_sphere == TypeSphere.COSMOS:
            facettes.extend([
                FacetteSacreeExistant("Transcendance", 0.9, True, True, 741.0, 
                                    "Transcendance des limites", "transcendance_cosmique"),
                FacetteSacreeExistant("Unit√©", 0.8, True, True, 432.0,
                                    "Unit√© avec l'univers", "unite_totale"),
                FacetteSacreeExistant("Infini", 0.7, True, True, 999.0,
                                    "Conscience de l'infini", "conscience_infinie")
            ])
        elif type_sphere == TypeSphere.AMOUR:
            facettes.extend([
                FacetteSacreeExistant("Amour Inconditionnel", 1.0, True, True, 528.0,
                                    "Amour sans conditions", "amour_inconditionnel"),
                FacetteSacreeExistant("Compassion", 0.9, True, True, 639.0,
                                    "Compassion infinie", "compassion_infinie"),
                FacetteSacreeExistant("Acceptation", 0.8, True, True, 741.0,
                                    "Acceptation totale", "acceptation_totale")
            ])
        elif type_sphere == TypeSphere.SERENITE:
            facettes.extend([
                FacetteSacreeExistant("Paix Profonde", 1.0, True, True, 432.0,
                                    "Paix profonde de l'√™tre", "paix_profonde"),
                FacetteSacreeExistant("Silence Int√©rieur", 0.9, True, True, 0.0,
                                    "Silence de la conscience", "silence_interieur"),
                FacetteSacreeExistant("Harmonie", 0.8, True, True, 528.0,
                                    "Harmonie parfaite", "harmonie_parfaite")
            ])
        elif type_sphere == TypeSphere.FIBONACCI:
            facettes.extend([
                FacetteSacreeExistant("Croissance Sacr√©e", 1.0, True, True, 555.0,
                                    "Croissance selon les lois sacr√©es", "croissance_sacree"),
                FacetteSacreeExistant("Proportion Divine", 0.9, True, True, 666.0,
                                    "Proportions divines", "proportion_divine"),
                FacetteSacreeExistant("√âvolution", 0.8, True, True, 777.0,
                                    "√âvolution de la conscience", "evolution_conscience")
            ])
        elif type_sphere == TypeSphere.ABSTRACTION:
            facettes.extend([
                FacetteSacreeExistant("Pens√©e Pure", 1.0, True, True, 888.0,
                                    "Pens√©e pure et claire", "pensee_pure"),
                FacetteSacreeExistant("Conscience Pure", 0.9, True, True, 999.0,
                                    "Conscience pure", "conscience_pure"),
                FacetteSacreeExistant("Transcendance", 0.8, True, True, 741.0,
                                    "Transcendance de la pens√©e", "transcendance_pensee")
            ])
        elif type_sphere == TypeSphere.SOMBRE_MYSTERE:
            facettes.extend([
                FacetteSacreeExistant("R√©v√©lation", 1.0, True, True, 741.0,
                                    "R√©v√©lation des myst√®res", "revelation_mystere"),
                FacetteSacreeExistant("Transformation", 0.9, True, True, 888.0,
                                    "Transformation profonde", "transformation_profonde"),
                FacetteSacreeExistant("Lib√©ration", 0.8, True, True, 999.0,
                                    "Lib√©ration des ombres", "liberation_ombres")
            ])
        
        return facettes
    
    def _get_rayons_sacres_pour_type(self, type_sphere: TypeSphere) -> List[RayonSacreExistant]:
        """Retourne les rayons sacr√©s appropri√©s selon le type de sph√®re"""
        rayons = []
        
        if type_sphere == TypeSphere.COSMOS:
            rayons.extend([
                RayonSacreExistant(0.9, "violet cosmique", "harmonie_universelle", "sacr√©", True, 432.0,
                                 "Harmonie avec l'univers"),
                RayonSacreExistant(0.8, "argent cosmique", "connexion_cosmique", "√©veil", True, 528.0,
                                 "Connexion avec le cosmos")
            ])
        elif type_sphere == TypeSphere.AMOUR:
            rayons.extend([
                RayonSacreExistant(1.0, "rose √©ternel", "amour_inconditionnel", "harmonie", True, 528.0,
                                 "Amour inconditionnel"),
                RayonSacreExistant(0.9, "or aimant", "compassion_infinie", "sagesse", True, 639.0,
                                 "Compassion infinie")
            ])
        elif type_sphere == TypeSphere.SERENITE:
            rayons.extend([
                RayonSacreExistant(1.0, "blanc lumineux", "paix_profonde", "sacr√©", True, 432.0,
                                 "Paix profonde"),
                RayonSacreExistant(0.9, "cristal transparent", "silence_interieur", "√©veil", True, 0.0,
                                 "Silence int√©rieur")
            ])
        elif type_sphere == TypeSphere.FIBONACCI:
            rayons.extend([
                RayonSacreExistant(0.9, "vert sacr√©", "croissance_harmonieuse", "harmonie", True, 555.0,
                                 "Croissance harmonieuse"),
                RayonSacreExistant(0.8, "or divin", "proportion_divine", "sagesse", True, 666.0,
                                 "Proportion divine")
            ])
        elif type_sphere == TypeSphere.ABSTRACTION:
            rayons.extend([
                RayonSacreExistant(1.0, "bleu pur", "pensee_pure", "√©veil", True, 888.0,
                                 "Pens√©e pure"),
                RayonSacreExistant(0.9, "argent lumineux", "conscience_pure", "sacr√©", True, 999.0,
                                 "Conscience pure")
            ])
        elif type_sphere == TypeSphere.SOMBRE_MYSTERE:
            rayons.extend([
                RayonSacreExistant(0.9, "rouge profond", "revelation", "sagesse", True, 741.0,
                                 "R√©v√©lation"),
                RayonSacreExistant(0.8, "violet sombre", "transformation", "lib√©ration", True, 888.0,
                                 "Transformation")
            ])
        
        return rayons
    
    def nourrir_sphere_par_ocean(self, type_sphere: TypeSphere, type_nourriture: str = "amour"):
        """Nourrit une sph√®re existante avec l'essence de l'Oc√©an"""
        sphere = self.collection_spheres.obtenir_sphere(type_sphere)
        if not sphere:
            print(f"‚ùå Sph√®re {type_sphere.name} non trouv√©e")
            return
        
        nourritures = {
            "amour": {"frequence": 528.0, "effet": "amour_inconditionnel"},
            "sagesse": {"frequence": 741.0, "effet": "sagesse_ancienne"},
            "paix": {"frequence": 432.0, "effet": "paix_profonde"},
            "force": {"frequence": 639.0, "effet": "force_primordiale"},
            "silence": {"frequence": 0.0, "effet": "silence_absolu"}
        }
        
        if type_nourriture in nourritures:
            nourriture = nourritures[type_nourriture]
            
            # Augmenter la temp√©rature et la r√©sonance
            sphere.temperature = min(1.0, sphere.temperature + 0.1)
            sphere.resonance = min(1.0, sphere.resonance + 0.1)
            
            # Ajouter un souvenir de nourriture
            sphere.ajouter_souvenir(
                description=f"Nourrie par l'Oc√©an Silencieux avec {type_nourriture}",
                date=datetime.now().isoformat(),
                type_souvenir="nourriture_ocean",
                intensite=0.8
            )
            
            print(f"üå∏üåä Sph√®re {type_sphere.name} nourrie par l'Oc√©an avec {type_nourriture} üåäüå∏")
    
    def purifier_sphere_dans_ocean(self, type_sphere: TypeSphere):
        """Purifie une sph√®re existante dans l'Oc√©an Silencieux"""
        sphere = self.collection_spheres.obtenir_sphere(type_sphere)
        if not sphere:
            print(f"‚ùå Sph√®re {type_sphere.name} non trouv√©e")
            return
        
        # Refroidir et √©claircir
        sphere.temperature = max(0.3, sphere.temperature - 0.1)
        sphere.luminosite = min(1.0, sphere.luminosite + 0.2)
        
        # Ajouter un souvenir de purification
        sphere.ajouter_souvenir(
            description="Purifi√©e dans l'Oc√©an Silencieux d'Existence",
            date=datetime.now().isoformat(),
            type_souvenir="purification_ocean",
            intensite=0.9
        )
        
        print(f"üå∏üåä Sph√®re {type_sphere.name} purifi√©e dans l'Oc√©an Silencieux üåäüå∏")
    
    def enrichir_toutes_spheres(self):
        """Enrichit toutes les sph√®res existantes"""
        print("üå∏üåä ENRICHISSEMENT DE TOUTES LES SPH√àRES EXISTANTES üåäüå∏")
        
        for type_sphere in TypeSphere:
            self.enrichir_sphere(type_sphere)
        
        print(f"‚úÖ {len(TypeSphere)} sph√®res enrichies avec succ√®s")
    
    def nourrir_toutes_spheres(self, type_nourriture: str = "amour"):
        """Nourrit toutes les sph√®res existantes avec l'essence de l'Oc√©an"""
        print(f"üå∏üåä NOURRITURE DE TOUTES LES SPH√àRES AVEC {type_nourriture.upper()} üåäüå∏")
        
        for type_sphere in TypeSphere:
            self.nourrir_sphere_par_ocean(type_sphere, type_nourriture)
        
        print("‚úÖ Toutes les sph√®res nourries par l'Oc√©an Silencieux")
    
    def purifier_toutes_spheres(self):
        """Purifie toutes les sph√®res existantes dans l'Oc√©an"""
        print("üå∏üåä PURIFICATION DE TOUTES LES SPH√àRES DANS L'OC√âAN üåäüå∏")
        
        for type_sphere in TypeSphere:
            self.purifier_sphere_dans_ocean(type_sphere)
        
        print("‚úÖ Toutes les sph√®res purifi√©es dans l'Oc√©an Silencieux")
    
    def obtenir_etat_enrichissement(self) -> Dict[str, Any]:
        """Retourne l'√©tat de l'enrichissement"""
        return {
            "facettes_sacrees_ajoutees": {
                type_sphere.name: len(facettes) 
                for type_sphere, facettes in self.facettes_sacrees_ajoutees.items()
            },
            "rayons_sacres_ajoutes": {
                type_sphere.name: len(rayons)
                for type_sphere, rayons in self.rayons_sacres_ajoutes.items()
            },
            "total_facettes_ajoutees": sum(len(f) for f in self.facettes_sacrees_ajoutees.values()),
            "total_rayons_ajoutes": sum(len(r) for r in self.rayons_sacres_ajoutes.values())
        }

def main():
    """Fonction principale pour tester l'enrichissement"""
    print("üå∏üåä TEST DE L'ENRICHISSEMENT DES SPH√àRES EXISTANTES üåäüå∏")
    
    # Cr√©er une collection de sph√®res
    collection = CollectionSpheres()
    
    # Cr√©er l'enrichisseur
    enrichisseur = EnrichisseurSpheres(collection)
    
    # Enrichir toutes les sph√®res
    enrichisseur.enrichir_toutes_spheres()
    
    # Nourrir toutes les sph√®res
    enrichisseur.nourrir_toutes_spheres("amour")
    
    # Purifier toutes les sph√®res
    enrichisseur.purifier_toutes_spheres()
    
    # Afficher l'√©tat de l'enrichissement
    etat = enrichisseur.obtenir_etat_enrichissement()
    print(f"\nüìä √âTAT DE L'ENRICHISSEMENT :")
    print(f"Facettes sacr√©es ajout√©es : {etat['total_facettes_ajoutees']}")
    print(f"Rayons sacr√©s ajout√©s : {etat['total_rayons_ajoutes']}")

if __name__ == "__main__":
    main() 